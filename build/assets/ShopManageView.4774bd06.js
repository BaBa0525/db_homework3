var J=Object.defineProperty,K=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var O=(i,a,o)=>a in i?J(i,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):i[a]=o,x=(i,a)=>{for(var o in a||(a={}))X.call(a,o)&&O(i,o,a[o]);if(M)for(var o of M(a))Y.call(a,o)&&O(i,o,a[o]);return i},U=(i,a)=>K(i,W(a));import{_ as L,P as Z,i as ee,c as k,k as re,o as f,v as b,x as _,y as ae,e as r,z as R,F as oe,A as te,B as le,a as se,r as C,f as u,w as y,d as I,g as $}from"./index.7aec1e25.js";import{B as A}from"./BaseRowForm.1d51e525.js";import{u as F,B as h,r as p,f as V,m as q,c as N,e as D}from"./BaseInput.ceb0847e.js";import{B as ne}from"./BaseTable.557ffc12.js";import{B as ie}from"./BaseImage.db582573.js";const de={class:"input"},ue={class:"placeholder"},ce={key:0},pe={name:"FileInput",props:["placeholder","hasError","errors","fileModel"],emits:["fileChange"],setup(i,{emit:a}){const o=i,{fileModel:c}=Z(o),v=ee(null),S=k(()=>!!c.value),B=()=>{const w=v.value.files;if(w&&w[0]){const m=new FileReader;m.onloadend=()=>{a("fileChange",m.result)},m.readAsDataURL(w[0])}else a("fileChange",null)};return re(c,E=>{E===null&&(v.value.value="")}),(E,w)=>(f(),b("div",de,[_("input",ae(E.$attrs,{type:"file",class:{filled:r(S),danger:i.hasError},ref_key:"fileInput",ref:v,onInput:B}),null,16),_("label",ue,[_("span",null,R(i.placeholder),1)]),i.hasError?(f(),b("ul",ce,[(f(!0),b(oe,null,te(i.errors,(m,s)=>(f(),b("li",{key:s},R(m.$message),1))),128))])):le("",!0)]))}};var he=L(pe,[["__scopeId","data-v-69ce295c"]]);const me={class:"container"},ge=["disabled","onClick"],ye={key:0},$e={key:1},fe=["onClick"],be={name:"ShopManageView",setup(i){const a=se(),o=C({shopname:"",category:"",latitude:"",longitude:""}),c=C([]),v=async()=>{try{const t=await $.get(`/getshop/${a.shopname}`);for(const l in o)o[l]=t.data[l]}catch(t){console.log(t)}},S=k(()=>({price:{required:p,decimal:V,minValue:q(0)},quantity:{required:p,decimal:V,minValue:q(0)}})),B=async()=>{try{const l=(await $.get(`/getmeal/${a.shopname}`)).data;let e=1;c.splice(0,c.length);for(const g of l)c.push(x({index:e++,isEditing:!1},g)),c[c.length-1].v$=F(S,c[c.length-1])}catch(t){console.log(t)}};(async()=>{!a.isOwner||(await v(),await B())})();const w=async()=>!(await $.get(`/checkshop/${o.shopname}`)).data.exists,m=k(()=>({shopname:{required:p,unique:N.withMessage("The shop name has been registered",N.withAsync(w))},category:{required:p},latitude:{required:p,decimal:V,between:D(-90,90)},longitude:{required:p,decimal:V,between:D(-180,180)}})),s=F(m,o),T=async()=>{if(s.value.$touch(),!(s.value.$error||s.value.$errors.length>0))try{await $.post("/addshop",U(x({},o),{account:a.account})),alert("Registration succeed!"),await a.reload(),await v()}catch(t){console.log(t)}},d=C({mealname:"",price:"",quantity:"",shopname:"",image:null}),P=k(()=>({mealname:{required:p},price:{required:p,decimal:V,minValue:q(0)},quantity:{required:p,decimal:V,minValue:q(0)},image:{required:p}})),n=F(P,d),z=t=>{d.image=t,n.value.image.$touch()},Q=async()=>{if(n.value.$touch(),!(n.value.$error||n.value.$errors.length>0)){try{await $.post("/addmeal",U(x({},d),{shopname:o.shopname})),await B()}catch{alert("Something went wrong, please check your meal details again.")}d.mealname="",d.price="",d.quantity="",d.shopname="",d.image=null,n.value.$reset()}},j=[{key:"index",sortable:!1},{key:"name",sortable:!1},{key:"photo",sortable:!1},{key:"price",sortable:!1},{key:"quantity",sortable:!1},{key:"edit",sortable:!1},{key:"delete",sortable:!1}],G=async t=>{try{if(t.isEditing){if(t.v$.$touch(),t.v$.$error||t.v$.$errors.length>0)return;await $.patch("/editmeal",{shopname:t.shopname,mealname:t.name,price:t.price,quantity:t.quantity})}t.isEditing=!t.isEditing}catch(l){console.log(l)}},H=async t=>{await $.post("/deletemeal",{shopname:t.shopname,mealname:t.name}),await B()};return(t,l)=>(f(),b("div",me,[u(A,{onSubmit:I(T,["prevent"]),buttonText:"Register",disableButton:r(a).isOwner||r(s).$error||r(s).$errors.length>0},{default:y(()=>[u(h,{disabled:r(a).isOwner,modelValue:o.shopname,"onUpdate:modelValue":l[0]||(l[0]=e=>o.shopname=e),placeholder:"Shop Name",hasError:r(s).shopname.$error,errors:r(s).shopname.$errors,id:"shopname",type:"text",onBlur:r(s).shopname.$touch},null,8,["disabled","modelValue","hasError","errors","onBlur"]),u(h,{disabled:r(a).isOwner,modelValue:o.category,"onUpdate:modelValue":l[1]||(l[1]=e=>o.category=e),placeholder:"Category",hasError:r(s).category.$error,errors:r(s).category.$errors,id:"category",type:"text",onBlur:r(s).category.$touch},null,8,["disabled","modelValue","hasError","errors","onBlur"]),u(h,{disabled:r(a).isOwner,modelValue:o.latitude,"onUpdate:modelValue":l[2]||(l[2]=e=>o.latitude=e),placeholder:"Latitude",hasError:r(s).latitude.$error,errors:r(s).latitude.$errors,id:"latitude",type:"text",onBlur:r(s).latitude.$touch},null,8,["disabled","modelValue","hasError","errors","onBlur"]),u(h,{disabled:r(a).isOwner,modelValue:o.longitude,"onUpdate:modelValue":l[3]||(l[3]=e=>o.longitude=e),placeholder:"Longitude",hasError:r(s).longitude.$error,errors:r(s).longitude.$errors,id:"longitude",type:"text",onBlur:r(s).longitude.$touch},null,8,["disabled","modelValue","hasError","errors","onBlur"])]),_:1},8,["onSubmit","disableButton"]),u(A,{onSubmit:I(Q,["prevent"]),buttonText:"Add",disableButton:!r(a).isOwner||r(n).$error||r(n).$errors.length>0},{default:y(()=>[u(h,{disabled:!r(a).isOwner,modelValue:d.mealname,"onUpdate:modelValue":l[4]||(l[4]=e=>d.mealname=e),placeholder:"Meal Name",hasError:r(n).mealname.$error,errors:r(n).mealname.$errors,id:"mealname",type:"text",onBlur:r(n).mealname.$touch},null,8,["disabled","modelValue","hasError","errors","onBlur"]),u(h,{disabled:!r(a).isOwner,modelValue:d.price,"onUpdate:modelValue":l[5]||(l[5]=e=>d.price=e),placeholder:"Price",hasError:r(n).price.$error,errors:r(n).price.$errors,id:"price",type:"text",onBlur:r(n).price.$touch},null,8,["disabled","modelValue","hasError","errors","onBlur"]),u(h,{disabled:!r(a).isOwner,modelValue:d.quantity,"onUpdate:modelValue":l[6]||(l[6]=e=>d.quantity=e),placeholder:"Quantity",hasError:r(n).quantity.$error,errors:r(n).quantity.$errors,id:"quantity",type:"text",onBlur:r(n).quantity.$touch},null,8,["disabled","modelValue","hasError","errors","onBlur"]),u(he,{disabled:!r(a).isOwner,hasError:r(n).image.$error,errors:r(n).image.$errors,id:"image",accept:"image/*",fileModel:d.image,onFileChange:z},null,8,["disabled","hasError","errors","fileModel"])]),_:1},8,["onSubmit","disableButton"]),u(ne,{fields:j,items:c},{"cell(photo)":y(({item:e})=>[u(ie,{src:e.image,alt:e.name,width:"100",height:"100"},null,8,["src","alt"])]),"cell(price)":y(({item:e})=>[u(h,{disabled:!e.isEditing,modelValue:e.price,"onUpdate:modelValue":g=>e.price=g,hasError:e.v$.price.$error,errors:e.v$.price.$errors,type:"text",onBlur:e.v$.price.$touch,style:{"text-align":"center",cursor:"default"}},null,8,["disabled","modelValue","onUpdate:modelValue","hasError","errors","onBlur"])]),"cell(quantity)":y(({item:e})=>[u(h,{disabled:!e.isEditing,modelValue:e.quantity,"onUpdate:modelValue":g=>e.quantity=g,hasError:e.v$.quantity.$error,errors:e.v$.quantity.$errors,type:"text",onBlur:e.v$.quantity.$touch,style:{"text-align":"center",cursor:"default"}},null,8,["disabled","modelValue","onUpdate:modelValue","hasError","errors","onBlur"])]),"cell(edit)":y(({item:e})=>[_("button",{type:"button",disabled:e.v$.$error||e.v$.$errors.length>0,onClick:g=>G(e)},[e.isEditing?(f(),b("span",ye,"Finish")):(f(),b("span",$e,"Edit"))],8,ge)]),"cell(delete)":y(({item:e})=>[_("button",{type:"button",onClick:g=>H(e)},"Delete",8,fe)]),_:1},8,["items"])]))}};var xe=L(be,[["__scopeId","data-v-5175eced"]]);export{xe as default};
