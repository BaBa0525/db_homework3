var ie=Object.defineProperty,ue=Object.defineProperties;var de=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var ce=Object.prototype.hasOwnProperty,pe=Object.prototype.propertyIsEnumerable;var j=(n,u,i)=>u in n?ie(n,u,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[u]=i,O=(n,u)=>{for(var i in u||(u={}))ce.call(u,i)&&j(n,i,u[i]);if(W)for(var i of W(u))pe.call(u,i)&&j(n,i,u[i]);return n},U=(n,u)=>ue(n,de(u));import{_ as he,r as $,c as D,a as me,i as R,o as L,v as q,x as c,f as d,w as g,d as ye,e as a,C as H,F as J,A as ge,J as ve,z as b,I as fe,K as be,L as we,g as T}from"./index.7aec1e25.js";import{u as $e,B as k,a as ke,f as K,c as N,m as G}from"./BaseInput.ceb0847e.js";import{u as Ve}from"./sidebar.0e291cee.js";import{B as X}from"./BaseImage.db582573.js";import{B as Y}from"./BaseDropDown.e4f132dc.js";import{B as xe}from"./BaseRowForm.1d51e525.js";import{B as z}from"./BaseTable.557ffc12.js";import{P as Z}from"./PopupModal.264a6550.js";var ee={exports:{}};(function(n){var u=function(){var i={km:6371,mile:3960,meter:6371e3,nmi:3440},l=function(r){return r*Math.PI/180},V=function(r,s){switch(r){case"[lat,lon]":return{latitude:s[0],longitude:s[1]};case"[lon,lat]":return{latitude:s[1],longitude:s[0]};case"{lon,lat}":return{latitude:s.lat,longitude:s.lon};case"{lat,lng}":return{latitude:s.lat,longitude:s.lng};case"geojson":return{latitude:s.geometry.coordinates[1],longitude:s.geometry.coordinates[0]};default:return s}};return function(s,x,h){h=h||{};var m=h.unit in i?i[h.unit]:i.km,v=V(h.format,s),w=V(h.format,x),B=l(w.latitude-v.latitude),S=l(w.longitude-v.longitude),p=l(v.latitude),y=l(w.latitude),_=Math.sin(B/2)*Math.sin(B/2)+Math.sin(S/2)*Math.sin(S/2)*Math.cos(p)*Math.cos(y),M=2*Math.atan2(Math.sqrt(_),Math.sqrt(1-_));return h.threshold?h.threshold>m*M:m*M}}();n.exports&&(n.exports=u)})(ee);var Be=ee.exports;const Se=n=>(be("data-v-db9ed744"),n=n(),we(),n),_e=["onClick"],Me={class:"page-list"},Ce=["onClick"],Pe=["disabled","onClick"],Ee=["disabled","onClick"],Ie=["disabled"],Qe={class:"totalprice"},Fe=Se(()=>c("hr",null,null,-1)),De=["disable"],Oe={name:"SearchShopView",setup(n){const u=["near","middle","far"],i=Ve(),l=$({shopname:"",distance:"",pricelow:"",pricehigh:"",category:"",meal:"",page:1}),V=D(()=>({shopname:{alphaNum:ke},distance:{},pricelow:{decimal:K,minValue:N.withMessage("Invalid minimum price",G(0))},pricehigh:{decimal:K,minValue:N.withMessage("Invalid maximum price",G(Math.max(0,l.pricelow)))},category:{},meal:{}})),r=$e(V,l),s=me(),x=R(0),h=[{key:"index",sortable:!1},{key:"shopname",sortable:!0},{key:"distance",sortable:!0},{key:"category",sortable:!0},{key:"action",sortable:!1}],m=$([]),v=async(o="")=>{try{const t=await T.post("/getshop",U(O({},l),{latitude:s.latitude,longitude:s.longitude,order:o})),e=t.data.shops,f=t.data.count;x.value=Math.ceil(f/5);let ne=1;m.splice(0,m.length);for(const F of e)m.push({index:ne++,shopname:F.shopname,distance:Be({latitude:s.latitude,longitude:s.longitude},{latitude:F.latitude,longitude:F.longitude},{unit:"meter"}),category:F.category})}catch(t){console.log(t)}},w=async()=>{r.value.$touch(),!r.value.$error&&await v()},B=async(o,t)=>{m.length!==0&&await v(`${o}$${t}`)},S=async o=>{l.page!==o&&(alert("change to page "+o),l.page=o,await v())},p=$({active:!1,shopname:""}),y=$([]),_=async()=>{y.splice(0,y.length);try{const t=(await T.get(`/getmeal/${p.shopname}`)).data;let e=1;for(const f of t)y.push(U(O({},f),{index:e++,orderQuantity:0}))}catch(o){console.log(o)}},M=async o=>{p.active=!0,p.shopname=o.shopname,await _()},te=[{key:"index",sortable:!1},{key:"picture",sortable:!1},{key:"name",sortable:!1},{key:"price",sortable:!1},{key:"quantity",sortable:!1},{key:"order",sortable:!1}],ae=["Delivery","Pickup"],C=R("Delivery"),A=(o,t)=>{o.orderQuantity+=t},re=()=>{P.value=y.filter(o=>o.orderQuantity>0),p.active=!1,E.active=!0},P=R([]),E=$({active:!1}),I=D(()=>{let o=0;for(const t of P.value)o+=t.price*t.orderQuantity;return o}),Q=D(()=>{const o=m.filter(t=>t.shopname===p.shopname)[0].distance;return C.value==="Pickup"?0:Math.round(Math.max(10,o/1e3*10))}),oe=async()=>{try{await T.post("/addorder",{account:s.account,shopname:p.shopname,meals:P.value,type:C.value,subtotal:I.value,deliverFee:Q.value}),alert("Order Successfully")}catch(o){alert(o.response.data.message)}E.active=!1},le=[{key:"picture",sortable:!1},{key:"name",sortable:!1},{key:"price",sortable:!1},{key:"orderQuantity",sortable:!1}],se=D(()=>{let o=!0;for(const t of y)if(t.orderQuantity>0){o=!1;break}return o});return(o,t)=>(L(),q(J,null,[c("div",{class:"form-container",style:H({margin:"0 auto","max-width":`calc(100% - ${a(i).sidebarWidth} - 4rem)`})},[d(xe,{onSubmit:ye(w,["prevent"]),"button-text":"Search",disableButton:a(r).$error||a(r).$errors.length>0},{default:g(()=>[d(k,{modelValue:l.shopname,"onUpdate:modelValue":t[0]||(t[0]=e=>l.shopname=e),placeholder:"Shop Name",hasError:a(r).shopname.$error,errors:a(r).shopname.$errors,id:"shopname",type:"text",styling:{width:"calc(100% / 7)"},onBlur:a(r).shopname.$touch},null,8,["modelValue","hasError","errors","styling","onBlur"]),d(Y,{modelValue:l.distance,"onUpdate:modelValue":t[1]||(t[1]=e=>l.distance=e),placeholder:"Distance",hasError:a(r).distance.$error,errors:a(r).distance.$errors,id:"distance",options:u,styling:{width:"calc(100% / 7)"},onBlur:a(r).distance.$touch},null,8,["modelValue","hasError","errors","styling","onBlur"]),d(k,{modelValue:l.pricelow,"onUpdate:modelValue":t[2]||(t[2]=e=>l.pricelow=e),placeholder:"Price Low",hasError:a(r).pricelow.$error,errors:a(r).pricelow.$errors,id:"pricelow",type:"text",styling:{width:"calc(100% / 7)"},onBlur:a(r).pricelow.$touch},null,8,["modelValue","hasError","errors","styling","onBlur"]),d(k,{modelValue:l.pricehigh,"onUpdate:modelValue":t[3]||(t[3]=e=>l.pricehigh=e),placeholder:"Price High",hasError:a(r).pricehigh.$error,errors:a(r).pricehigh.$errors,id:"pricehigh",type:"text",styling:{width:"calc(100% / 7)"},onBlur:a(r).pricehigh.$touch},null,8,["modelValue","hasError","errors","styling","onBlur"]),d(k,{modelValue:l.category,"onUpdate:modelValue":t[4]||(t[4]=e=>l.category=e),placeholder:"Category",hasError:a(r).category.$error,errors:a(r).category.$errors,id:"category",type:"text",styling:{width:"calc(100% / 7)"},onBlur:a(r).category.$touch},null,8,["modelValue","hasError","errors","styling","onBlur"]),d(k,{modelValue:l.meal,"onUpdate:modelValue":t[5]||(t[5]=e=>l.meal=e),placeholder:"Meal",hasError:a(r).meal.$error,errors:a(r).meal.$errors,id:"meal",type:"text",styling:{width:"calc(100% / 7)"},onBlur:a(r).meal.$touch},null,8,["modelValue","hasError","errors","styling","onBlur"])]),_:1},8,["onSubmit","disableButton"])],4),c("div",{class:"table-container",style:H({margin:"0 auto","max-width":`calc(100% - ${a(i).sidebarWidth} - 4rem)`})},[d(z,{fields:h,items:m,onSortBy:B},{"cell(distance)":g(({item:e})=>[ve(b(Math.round(e.distance))+" m ",1)]),"cell(action)":g(({item:e})=>[c("button",{type:"button",onClick:f=>M(e)},"Open Menu",8,_e)]),_:1},8,["items"])],4),c("ul",Me,[(L(!0),q(J,null,ge(x.value,e=>(L(),q("li",{class:fe({"current-page":l.page===e}),onClick:f=>S(e)},b(e),11,Ce))),256))]),d(Z,{show:p.active,titles:`Menu of ${p.shopname}`,onClosePopup:t[8]||(t[8]=e=>p.active=!1)},{default:g(()=>[d(z,{fields:te,items:y},{"cell(picture)":g(({item:e})=>[d(X,{src:e.image,alt:e.name,width:"100",height:"100"},null,8,["src","alt"])]),"cell(order)":g(({item:e})=>[c("button",{type:"button",disabled:e.orderQuantity<=0,onClick:f=>A(e,-1)},"-",8,Pe),c("span",null,b(e.orderQuantity),1),c("button",{type:"button",disabled:e.orderQuantity>=e.quantity,onClick:f=>A(e,1)},"+",8,Ee)]),_:1},8,["items"]),d(Y,{modelValue:C.value,"onUpdate:modelValue":t[6]||(t[6]=e=>C.value=e),options:ae},null,8,["modelValue"]),c("button",{type:"button",disabled:a(se),onClick:t[7]||(t[7]=e=>re())},"Calculate Price",8,Ie)]),_:1},8,["show","titles"]),d(Z,{show:E.active,titles:"Order Preview",onClosePopup:t[9]||(t[9]=e=>E.active=!1)},{default:g(()=>[d(z,{fields:le,items:P.value},{"cell(picture)":g(({item:e})=>[d(X,{src:e.image,alt:e.name,width:"100",height:"100"},null,8,["src","alt"])]),_:1},8,["items"]),c("div",Qe,[c("p",null,"Subtotal $"+b(a(I)),1),c("p",null,"Delivery Fee $"+b(a(Q)),1),Fe,c("p",null,"Total Price $"+b(a(I)+a(Q)),1)]),c("button",{type:"button",disable:a(s).balance<a(I)+a(Q),onClick:oe},"Order",8,De)]),_:1},8,["show"])],64))}};var He=he(Oe,[["__scopeId","data-v-db9ed744"]]);export{He as default};
